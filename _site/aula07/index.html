<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Aula 07 - Modelando</title>
	<meta name="description" content="Slides dessa aula">
	
	<link rel="canonical" href="http://curso-r.github.io/versao2016//aula07/">
	<link rel="alternate" type="application/rss+xml" title="Curso-R 2016" href="http://curso-r.github.io/versao2016//feed.xml" />
	
	<!-- <link rel="stylesheet" href="/css/main.css"> -->

	<link rel="stylesheet" type="text/css" href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css">
	<!-- <link rel="stylesheet" type="text/css" href="http://apps.bdimg.com/libs/fontawesome/4.2.0/css/font-awesome.min.css"> -->
	<!-- <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css"> -->
	

	<link rel="stylesheet" type="text/css" href="/static/css/index.css">
	
	<!-- <script type="text/javascript" src="/static/js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="/static/js/bootstrap.min.js"></script> -->

	<script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>

	<script type="text/javascript" src="/static/js/index.js"></script>
	
	<link rel="stylesheet" type="text/css" href="http://apps.bdimg.com/libs/highlight.js/8.4/styles/monokai_sublime.min.css">
	<!-- <link rel="stylesheet" type="text/css" href="http://apps.bdimg.com/libs/highlight.js/8.4/styles/railscasts.min.css"> -->
	<!-- <link rel="stylesheet" type="text/css" href="http://apps.bdimg.com/libs/highlight.js/8.4/styles/monokai.min.css"> -->
	<!-- <script type="text/javascript" src="http://apps.bdimg.com/libs/highlight.js/8.4/languages/dos.min.js"></script> -->
	<script type="text/javascript" src="http://apps.bdimg.com/libs/highlight.js/8.4/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>

</head>

 <!--  <body data-spy="scroll" data-target="#myAffix"> -->
  <body>

    <header>

<!-- navbar -->
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Curso-R 2016</a>
      <p class="navbar-text"></p>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">

        
          <li>
        
        <a href="/"><span class="glyphicon glyphicon-th-large"></span> Blog</a></li>

        
          
            
              <li>
            
            <a href="/projects/"><span class="glyphicon glyphicon-file"></span> Projects</a></li>
          
        
          
            
              <li>
            
            <a href="/about/"><span class="glyphicon glyphicon-heart"></span> About</a></li>
          
        
          
        
          
        
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

</header>

    <div id="main" class="container main">
      <div class="row">
  <div id="myArticle" class="col-sm-9">
    <div class="post-area post">
      <header>
        <h1>Aula 07 - Modelando</h1>
        <p>Feb 2, 2015</p>
      </header>
      <hr>
      <article>
        <p><a href="http://curso-r.github.io/slides/aula_07_apresentacao.html" target="_blank">Slides dessa aula</a></p>

<p><a href="http://curso-r.github.io/script/aula_07.R" target="_blank">Script dessa aula</a></p>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in library(pander): there is no package called &#39;pander&#39;</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): não foi possível encontrar a função &quot;panderOptions&quot;</code></pre></div>

<h1 id="regresso-linear-e-anova">Regressão Linear e ANOVA</h1>

<p>O R tem todo o ferramentário necessário para fazer modelos lineares, a começar pelo modelo de regressão linear normal.</p>

<p>Para ilustrar, vamos utilizar a base de dados <code>mtcars</code> que vem no R.</p>

<p>Cada uma das 32 linhas da base <code>mtcars</code> representa um carro. A variável <code>mpg</code> é o consumo de combustível em milhas por galão (~3.76 Litros) e iremos tentar explicá-la pelas demais características dos veículos.</p>

<h2 id="um-pouco-de-descritiva">Um pouco de descritiva</h2>

<h3 id="univariada">Univariada</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># os dados</span>
<span class="kp">head</span><span class="p">(</span>mtcars<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># banco de dados das variáveis contínuas no formato &quot;longo&quot;</span>
mtcars_long <span class="o">&lt;-</span> mtcars <span class="o">%&gt;%</span>  
  select<span class="p">(</span>mpg<span class="p">,</span> disp<span class="o">:</span>qsec<span class="p">)</span> <span class="o">%&gt;%</span>
  gather<span class="p">(</span>var_continuas<span class="p">)</span> 

<span class="c1"># medidas resumo para variáveis contínuas</span>
mtcars_long <span class="o">%&gt;%</span>
  group_by<span class="p">(</span>var_continuas<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span><span class="s">&quot;N&quot;</span> <span class="o">=</span> n<span class="p">(),</span>
            <span class="s">&quot;Missing&quot;</span> <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span>value<span class="p">)),</span>
            <span class="s">&quot;Media&quot;</span> <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>value<span class="p">),</span>
            <span class="s">&quot;DesvPad&quot;</span> <span class="o">=</span> sd<span class="p">(</span>value<span class="p">),</span>
            <span class="s">&quot;Minimo&quot;</span> <span class="o">=</span> <span class="kp">min</span><span class="p">(</span>value<span class="p">),</span>
            <span class="s">&quot;Q1&quot;</span> <span class="o">=</span> quantile<span class="p">(</span>value<span class="p">,</span> <span class="m">0.25</span><span class="p">),</span>
            <span class="s">&quot;Mediana&quot;</span> <span class="o">=</span> quantile<span class="p">(</span>value<span class="p">,</span> <span class="m">0.50</span><span class="p">),</span>
            <span class="s">&quot;Q3&quot;</span> <span class="o">=</span> quantile<span class="p">(</span>value<span class="p">,</span> <span class="m">0.75</span><span class="p">),</span>
            <span class="s">&quot;Maximo&quot;</span> <span class="o">=</span> <span class="kp">max</span><span class="p">(</span>value<span class="p">))</span> <span class="o">%&gt;%</span>
  mutate_each<span class="p">(</span>funs<span class="p">(</span><span class="kp">round</span><span class="p">(</span><span class="m">.</span><span class="p">,</span><span class="m">1</span><span class="p">)),</span> <span class="o">-</span>var_continuas<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [6 x 10]
## 
##   var_continuas     N Missing Media DesvPad Minimo    Q1 Mediana
##          (fctr) (dbl)   (dbl) (dbl)   (dbl)  (dbl) (dbl)   (dbl)
## 1           mpg    32       0  20.1     6.0   10.4  15.4    19.2
## 2          disp    32       0 230.7   123.9   71.1 120.8   196.3
## 3            hp    32       0 146.7    68.6   52.0  96.5   123.0
## 4          drat    32       0   3.6     0.5    2.8   3.1     3.7
## 5            wt    32       0   3.2     1.0    1.5   2.6     3.3
## 6          qsec    32       0  17.8     1.8   14.5  16.9    17.7
## Variables not shown: Q3 (dbl), Maximo (dbl)</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># boxplots</span>
mtcars_long <span class="o">%&gt;%</span>
  ggplot<span class="p">()</span> <span class="o">+</span>
  geom_boxplot<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span><span class="m">1</span><span class="p">,</span> y <span class="o">=</span> value<span class="p">))</span> <span class="o">+</span>
  facet_wrap<span class="p">(</span><span class="o">~</span>var_continuas<span class="p">,</span> scales <span class="o">=</span> <span class="s">&quot;free&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" /></p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># frequencias de variáveis categóricas</span>
mtcars_freq <span class="o">&lt;-</span> mtcars <span class="o">%&gt;%</span>
  select<span class="p">(</span>cyl<span class="p">,</span> vs<span class="o">:</span>carb<span class="p">)</span> <span class="o">%&gt;%</span>
  gather<span class="p">(</span>vars_categoricas<span class="p">)</span> <span class="o">%&gt;%</span>
  rename<span class="p">(</span>categoria <span class="o">=</span> value<span class="p">)</span> <span class="o">%&gt;%</span>
  group_by<span class="p">(</span>vars_categoricas<span class="p">,</span> categoria<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span>freq <span class="o">=</span> n<span class="p">())</span> <span class="o">%&gt;%</span>
  group_by<span class="p">(</span>vars_categoricas<span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>prop <span class="o">=</span> freq<span class="o">/</span><span class="kp">sum</span><span class="p">(</span>freq<span class="p">),</span>
         prop_txt <span class="o">=</span> <span class="p">(</span>prop<span class="o">*</span><span class="m">100</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">round</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">paste0</span><span class="p">(</span><span class="s">&quot;%&quot;</span><span class="p">))</span>

mtcars_freq</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [16 x 5]
## Groups: vars_categoricas [5]
## 
##    vars_categoricas categoria  freq    prop prop_txt
##              (fctr)     (dbl) (int)   (dbl)    (chr)
## 1               cyl         4    11 0.34375      34%
## 2               cyl         6     7 0.21875      22%
## 3               cyl         8    14 0.43750      44%
## 4                vs         0    18 0.56250      56%
## 5                vs         1    14 0.43750      44%
## 6                am         0    19 0.59375      59%
## 7                am         1    13 0.40625      41%
## 8              gear         3    15 0.46875      47%
## 9              gear         4    12 0.37500      38%
## 10             gear         5     5 0.15625      16%
## 11             carb         1     7 0.21875      22%
## 12             carb         2    10 0.31250      31%
## 13             carb         3     3 0.09375       9%
## 14             carb         4    10 0.31250      31%
## 15             carb         6     1 0.03125       3%
## 16             carb         8     1 0.03125       3%</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Gráfico de barras</span>
mtcars_freq <span class="o">%&gt;%</span>
  ggplot<span class="p">()</span> <span class="o">+</span>
  geom_bar<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>categoria<span class="p">,</span> y <span class="o">=</span> freq<span class="p">),</span> position <span class="o">=</span> <span class="s">&quot;dodge&quot;</span><span class="p">,</span> stat <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">)</span> <span class="o">+</span>
  facet_wrap<span class="p">(</span><span class="o">~</span>vars_categoricas<span class="p">,</span> scales<span class="o">=</span><span class="s">&quot;free&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-2-2.png" alt="plot of chunk unnamed-chunk-2" /></p>

<h3 id="versus-mpg">Versus <code>mpg</code></h3>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Matriz de correlação linear</span>
mtcars <span class="o">%&gt;%</span>  
  select<span class="p">(</span>mpg<span class="p">,</span> disp<span class="o">:</span>qsec<span class="p">)</span> <span class="o">%&gt;%</span>
  cor <span class="o">%&gt;%</span>
  <span class="kp">round</span><span class="p">(</span><span class="m">2</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##        mpg  disp    hp  drat    wt  qsec
## mpg   1.00 -0.85 -0.78  0.68 -0.87  0.42
## disp -0.85  1.00  0.79 -0.71  0.89 -0.43
## hp   -0.78  0.79  1.00 -0.45  0.66 -0.71
## drat  0.68 -0.71 -0.45  1.00 -0.71  0.09
## wt   -0.87  0.89  0.66 -0.71  1.00 -0.17
## qsec  0.42 -0.43 -0.71  0.09 -0.17  1.00</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Matriz de dispersão</span>
pairs<span class="p">(</span>mtcars <span class="o">%&gt;%</span>  
  select<span class="p">(</span>mpg<span class="p">,</span> disp<span class="o">:</span>qsec<span class="p">))</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /></p>

<h2 id="regresso-linear">Regressão linear</h2>
<p>A função que ajusta modelo linear normal no R é <code>lm()</code>. Você especifica o banco de dados e a fórmula com as variáveis que você deseja associar.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste <span class="o">&lt;-</span> lm<span class="p">(</span>resposta <span class="o">~</span> explicativas<span class="p">,</span> data <span class="o">=</span> meus_dados<span class="p">)</span></code></pre></div>

<p>O objeto <code>ajuste</code> contém todos os resultados e com a ajuda de alguns comandos, você extrai tudo o que é interessante.</p>

<p>Exemplo:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste_lm <span class="o">&lt;-</span> lm<span class="p">(</span>mpg <span class="o">~</span> wt<span class="p">,</span> data <span class="o">=</span> mtcars<span class="p">)</span>

ajuste_lm</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## 
## Call:
## lm(formula = mpg ~ wt, data = mtcars)
## 
## Coefficients:
## (Intercept)           wt  
##      37.285       -5.344</code></pre></div>

<p>No código acima temos <code>mpg</code> explicado por <code>wt</code>. A saída do <code>lm()</code> mostra qual foi a chamada do modelo e os coeficientes ajustados. Como visto na análise descritiva, há uma clara associação linear e negativa entre as variáveis, justificando o parâmetro negativo <code>wt = -5.344</code>. A função <code>coeficients()</code> ou <code>coef()</code> nos fornece os coeficientes ajustados.</p>

<p>Gráfico da reta ajustada:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># extrai os coeficientes ajustados</span>
coeficientes <span class="o">&lt;-</span> coef<span class="p">(</span>ajuste_lm<span class="p">)</span>

ggplot<span class="p">(</span>mtcars<span class="p">)</span> <span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> wt<span class="p">,</span> y <span class="o">=</span> mpg<span class="p">))</span> <span class="o">+</span>
  geom_abline<span class="p">(</span>intercept <span class="o">=</span> coeficientes<span class="p">[</span><span class="m">1</span><span class="p">],</span> slope <span class="o">=</span> coeficientes<span class="p">[</span><span class="m">2</span><span class="p">])</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /></p>

<p><strong>summary()</strong></p>

<p>A função <code>summary()</code> é uma função genérica que geralmente devolve um resumo de informações úteis de praticamente qualquer classe de objetos. Para objetos <code>lm()</code> ela devolve:</p>

<ol>
  <li>Chamada do modelo</li>
  <li>Medidas resumo dos resíduos</li>
  <li>Tabela de coeficientes, desvios padrão e testes T para hipótese nula de parâmetros iguais a zero.</li>
  <li>Média dos quadrados do resíduo e os respectivos graus de liberdade; $R^2$ e $R^2$ ajustado da regressão; Estatística F para qualidade do ajuste (comparação com o modelo com apenas o intercepto).</li>
</ol>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">summary</span><span class="p">(</span>ajuste_lm<span class="p">)</span></code></pre></div>

<p><img src="assets/fig/summary_lm.png" alt="summary lm" /></p>

<p><strong>plot()</strong></p>

<p>A função <code>plot()</code> constrói gráficos úteis para diagnóstico do modelo.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># opção para mostrar 4 gráficos em uma mesma figura</span>
par<span class="p">(</span>mfrow <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>

<span class="c1"># gráficos de diagnóstico do modelo ajuste_lm</span>
plot<span class="p">(</span>ajuste_lm<span class="p">)</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" /></p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># retorna ao normal</span>
par<span class="p">(</span>mfrow <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span></code></pre></div>

<p><strong>anova()</strong></p>

<p>Uma parte importante da modelagem é a redução de modelos. A função <code>anova()</code> compara dois (ou mais) modelos encaixados por meio da estatística F (por padrão), especialmente indicadas para modelos lineares normais. Caso seja passada apenas um ajuste à função, ela devolve a tabela de ANOVA (termos testados sequencialmente).</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># modelo nulo, com apenas o intercepto</span>
ajuste_lm_nulo <span class="o">&lt;-</span> lm<span class="p">(</span>mpg <span class="o">~</span> <span class="m">1</span><span class="p">,</span> data <span class="o">=</span> mtcars<span class="p">)</span>

<span class="c1"># modelo com wt e cyl</span>
ajuste_lm2 <span class="o">&lt;-</span> lm<span class="p">(</span>mpg <span class="o">~</span> wt <span class="o">+</span> <span class="kp">factor</span><span class="p">(</span>cyl<span class="p">),</span> data <span class="o">=</span> mtcars<span class="p">)</span>

<span class="c1"># compara o modelo com wt com o modelo nulo</span>
anova<span class="p">(</span>ajuste_lm_nulo<span class="p">,</span> ajuste_lm<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Analysis of Variance Table
## 
## Model 1: mpg ~ 1
## Model 2: mpg ~ wt
##   Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1     31 1126.05                                  
## 2     30  278.32  1    847.73 91.375 1.294e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Tabela de ANOVA, testa os termos sequencialmente</span>
anova<span class="p">(</span>ajuste_lm2<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Analysis of Variance Table
## 
## Response: mpg
##             Df Sum Sq Mean Sq  F value    Pr(&gt;F)    
## wt           1 847.73  847.73 129.6650 5.079e-12 ***
## factor(cyl)  2  95.26   47.63   7.2856  0.002835 ** 
## Residuals   28 183.06    6.54                       
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre></div>

<p>A o valor-p = 0.001064 indica que o modelo com <code>wt + cyl</code> trás melhorias significantes no poder explicativo do modelo quando comparado ao modelo com apenas <code>wt</code>.</p>

<p><strong>demais comandos</strong></p>

<p>Outros comandos úteis são:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in function_list[[k]](value): não foi possível encontrar a função &quot;pander&quot;</code></pre></div>

<h2 id="frmulas">Fórmulas</h2>

<p>Objetos de classe <code>formula</code> possuem sintaxe muito conveniente para especificar o modelo estatístico que desejamos ajustar. O símbolo que define esses objetos é o <code>~</code>.</p>

<p>Estrutura:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste <span class="o">&lt;-</span> lm<span class="p">(</span>resposta <span class="o">~</span> explicativas<span class="p">)</span></code></pre></div>

<p>Então se o objetivo fosse ajustar o modelo</p>

<script type="math/tex; mode=display">Y_i = \beta_0 + \beta_1X_i + \epsilon_i,</script>

<p>passaríamos ao R a seguinte fórmula</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste <span class="o">&lt;-</span> lm<span class="p">(</span>Y <span class="o">~</span> X<span class="p">)</span></code></pre></div>

<p>Para incorporar mais variáveis usamos o símbolo <code>+</code>. O modelo</p>

<script type="math/tex; mode=display">Y_i = \beta_0 + \beta_1X_i + \beta_2Z_i + \epsilon_i,</script>

<p>ficaria traduzido como</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste <span class="o">&lt;-</span> lm<span class="p">(</span>Y <span class="o">~</span> X <span class="o">+</span> Z<span class="p">)</span></code></pre></div>

<p>Utilizamos o símbolo <code>*</code> para introduzir os componentes de interação, além dos componentes aditivos.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste <span class="o">&lt;-</span> lm<span class="p">(</span>Y <span class="o">~</span> X <span class="o">*</span> Z<span class="p">)</span></code></pre></div>

<p>Teoricamente teríamos, para Z <strong>contínua</strong>, o modelo de regressão</p>

<script type="math/tex; mode=display">Y_i = \beta_0 + \beta_1X_i + \beta_2Z_i + \beta_3X_i*Z_i + \epsilon_i,</script>

<p>Ou, para Z <strong>categórica</strong>, o modelo de ANCOVA</p>

<script type="math/tex; mode=display">Y_{ij} = \alpha_j + \beta_jX_{ij} + \epsilon_{ij},</script>

<p>O operador <code>:</code> faz com que apenas o componente de interação seja incluído no modelo. Para ilustrar, observe que o modelo</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste <span class="o">&lt;-</span> lm<span class="p">(</span>Y <span class="o">~</span> X <span class="o">*</span> Z<span class="p">)</span></code></pre></div>

<p>é a mesma coisa que</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste <span class="o">&lt;-</span> lm<span class="p">(</span>Y <span class="o">~</span> X <span class="o">+</span> Z <span class="o">+</span> X<span class="o">:</span>Z<span class="p">)</span></code></pre></div>

<p>Os operadores aritméticos exercem função diferente em fórmulas. O sinal de <code>+</code> no exemplo induziu em um modelo aditivo em vez de somar X com Z. Para fazer com que eles assumam seus significados aritméticos temos que utilizar a função <code>I()</code>. Exemplo:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste <span class="o">&lt;-</span> lm<span class="p">(</span>Y <span class="o">~</span> <span class="kp">I</span><span class="p">(</span>X <span class="o">+</span> Z<span class="p">))</span></code></pre></div>

<p>Agora sim o componente <code>I(X + Z)</code> representa a soma de X com Z. Outros exemplos: <code>I(X^2)</code>, <code>I(log(X + 1))</code>, <code>I(sqrt(X+Z*5))</code>.</p>

<p><strong>Tabela de simbolos para utilizar em fórmulas</strong></p>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in function_list[[k]](value): não foi possível encontrar a função &quot;pander&quot;</code></pre></div>

<h2 id="seleo-de-variveis">Seleção de variáveis</h2>

<h3 id="linearhypothesis">linearHypothesis</h3>

<p>Frequentemente temos interesse em saber se parâmetros são diferentes de zero ou se são diferentes entre si. Para isto, costumamos efetuar testes do tipo Wald para combinações lineares dos parâmetros.</p>

<p>Para este fim, a função <code>linearHypothesis()</code> do pacote <code>car</code> faz o trabalho.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>car<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in library(car): there is no package called &#39;car&#39;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">linearHypothesis<span class="p">(</span>ajuste_lm<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): não foi possível encontrar a função &quot;linearHypothesis&quot;</code></pre></div>

<h3 id="stepwise">stepwise</h3>

<p>Stepwise no R se faz com as funções <code>step()</code> do pacote <code>stats</code> ou <code>stepAIC()</code> do pacote <code>MASS</code>. Escolher entre <code>forward</code>, <code>backward</code> ou <code>both</code> (ambos) basta passar um desses nomes ao parâmetro <code>direction</code> da função.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># modelo aditivo completo</span>
ajuste_lm_completo <span class="o">&lt;-</span> lm<span class="p">(</span>mpg <span class="o">~</span> <span class="m">.</span><span class="p">,</span> data <span class="o">=</span> mtcars<span class="p">)</span>

<span class="c1"># modelo forward</span>
step<span class="p">(</span>ajuste_lm_completo<span class="p">,</span> direction <span class="o">=</span> <span class="s">&quot;forward&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Start:  AIC=70.9
## mpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## 
## Call:
## lm(formula = mpg ~ cyl + disp + hp + drat + wt + qsec + vs + 
##     am + gear + carb, data = mtcars)
## 
## Coefficients:
## (Intercept)          cyl         disp           hp         drat  
##    12.30337     -0.11144      0.01334     -0.02148      0.78711  
##          wt         qsec           vs           am         gear  
##    -3.71530      0.82104      0.31776      2.52023      0.65541  
##        carb  
##    -0.19942</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># modelo backward</span>
step<span class="p">(</span>ajuste_lm_completo<span class="p">,</span> direction <span class="o">=</span> <span class="s">&quot;backward&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Start:  AIC=70.9
## mpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb
## 
##        Df Sum of Sq    RSS    AIC
## - cyl   1    0.0799 147.57 68.915
## - vs    1    0.1601 147.66 68.932
## - carb  1    0.4067 147.90 68.986
## - gear  1    1.3531 148.85 69.190
## - drat  1    1.6270 149.12 69.249
## - disp  1    3.9167 151.41 69.736
## - hp    1    6.8399 154.33 70.348
## - qsec  1    8.8641 156.36 70.765
## &lt;none&gt;              147.49 70.898
## - am    1   10.5467 158.04 71.108
## - wt    1   27.0144 174.51 74.280
## 
## Step:  AIC=68.92
## mpg ~ disp + hp + drat + wt + qsec + vs + am + gear + carb
## 
##        Df Sum of Sq    RSS    AIC
## - vs    1    0.2685 147.84 66.973
## - carb  1    0.5201 148.09 67.028
## - gear  1    1.8211 149.40 67.308
## - drat  1    1.9826 149.56 67.342
## - disp  1    3.9009 151.47 67.750
## - hp    1    7.3632 154.94 68.473
## &lt;none&gt;              147.57 68.915
## - qsec  1   10.0933 157.67 69.032
## - am    1   11.8359 159.41 69.384
## - wt    1   27.0280 174.60 72.297
## 
## Step:  AIC=66.97
## mpg ~ disp + hp + drat + wt + qsec + am + gear + carb
## 
##        Df Sum of Sq    RSS    AIC
## - carb  1    0.6855 148.53 65.121
## - gear  1    2.1437 149.99 65.434
## - drat  1    2.2139 150.06 65.449
## - disp  1    3.6467 151.49 65.753
## - hp    1    7.1060 154.95 66.475
## &lt;none&gt;              147.84 66.973
## - am    1   11.5694 159.41 67.384
## - qsec  1   15.6830 163.53 68.200
## - wt    1   27.3799 175.22 70.410
## 
## Step:  AIC=65.12
## mpg ~ disp + hp + drat + wt + qsec + am + gear
## 
##        Df Sum of Sq    RSS    AIC
## - gear  1     1.565 150.09 63.457
## - drat  1     1.932 150.46 63.535
## &lt;none&gt;              148.53 65.121
## - disp  1    10.110 158.64 65.229
## - am    1    12.323 160.85 65.672
## - hp    1    14.826 163.35 66.166
## - qsec  1    26.408 174.94 68.358
## - wt    1    69.127 217.66 75.350
## 
## Step:  AIC=63.46
## mpg ~ disp + hp + drat + wt + qsec + am
## 
##        Df Sum of Sq    RSS    AIC
## - drat  1     3.345 153.44 62.162
## - disp  1     8.545 158.64 63.229
## &lt;none&gt;              150.09 63.457
## - hp    1    13.285 163.38 64.171
## - am    1    20.036 170.13 65.466
## - qsec  1    25.574 175.67 66.491
## - wt    1    67.572 217.66 73.351
## 
## Step:  AIC=62.16
## mpg ~ disp + hp + wt + qsec + am
## 
##        Df Sum of Sq    RSS    AIC
## - disp  1     6.629 160.07 61.515
## &lt;none&gt;              153.44 62.162
## - hp    1    12.572 166.01 62.682
## - qsec  1    26.470 179.91 65.255
## - am    1    32.198 185.63 66.258
## - wt    1    69.043 222.48 72.051
## 
## Step:  AIC=61.52
## mpg ~ hp + wt + qsec + am
## 
##        Df Sum of Sq    RSS    AIC
## - hp    1     9.219 169.29 61.307
## &lt;none&gt;              160.07 61.515
## - qsec  1    20.225 180.29 63.323
## - am    1    25.993 186.06 64.331
## - wt    1    78.494 238.56 72.284
## 
## Step:  AIC=61.31
## mpg ~ wt + qsec + am
## 
##        Df Sum of Sq    RSS    AIC
## &lt;none&gt;              169.29 61.307
## - am    1    26.178 195.46 63.908
## - qsec  1   109.034 278.32 75.217
## - wt    1   183.347 352.63 82.790</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## 
## Call:
## lm(formula = mpg ~ wt + qsec + am, data = mtcars)
## 
## Coefficients:
## (Intercept)           wt         qsec           am  
##       9.618       -3.917        1.226        2.936</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># modelo both</span>
step<span class="p">(</span>ajuste_lm_completo<span class="p">,</span> direction <span class="o">=</span> <span class="s">&quot;both&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Start:  AIC=70.9
## mpg ~ cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb
## 
##        Df Sum of Sq    RSS    AIC
## - cyl   1    0.0799 147.57 68.915
## - vs    1    0.1601 147.66 68.932
## - carb  1    0.4067 147.90 68.986
## - gear  1    1.3531 148.85 69.190
## - drat  1    1.6270 149.12 69.249
## - disp  1    3.9167 151.41 69.736
## - hp    1    6.8399 154.33 70.348
## - qsec  1    8.8641 156.36 70.765
## &lt;none&gt;              147.49 70.898
## - am    1   10.5467 158.04 71.108
## - wt    1   27.0144 174.51 74.280
## 
## Step:  AIC=68.92
## mpg ~ disp + hp + drat + wt + qsec + vs + am + gear + carb
## 
##        Df Sum of Sq    RSS    AIC
## - vs    1    0.2685 147.84 66.973
## - carb  1    0.5201 148.09 67.028
## - gear  1    1.8211 149.40 67.308
## - drat  1    1.9826 149.56 67.342
## - disp  1    3.9009 151.47 67.750
## - hp    1    7.3632 154.94 68.473
## &lt;none&gt;              147.57 68.915
## - qsec  1   10.0933 157.67 69.032
## - am    1   11.8359 159.41 69.384
## + cyl   1    0.0799 147.49 70.898
## - wt    1   27.0280 174.60 72.297
## 
## Step:  AIC=66.97
## mpg ~ disp + hp + drat + wt + qsec + am + gear + carb
## 
##        Df Sum of Sq    RSS    AIC
## - carb  1    0.6855 148.53 65.121
## - gear  1    2.1437 149.99 65.434
## - drat  1    2.2139 150.06 65.449
## - disp  1    3.6467 151.49 65.753
## - hp    1    7.1060 154.95 66.475
## &lt;none&gt;              147.84 66.973
## - am    1   11.5694 159.41 67.384
## - qsec  1   15.6830 163.53 68.200
## + vs    1    0.2685 147.57 68.915
## + cyl   1    0.1883 147.66 68.932
## - wt    1   27.3799 175.22 70.410
## 
## Step:  AIC=65.12
## mpg ~ disp + hp + drat + wt + qsec + am + gear
## 
##        Df Sum of Sq    RSS    AIC
## - gear  1     1.565 150.09 63.457
## - drat  1     1.932 150.46 63.535
## &lt;none&gt;              148.53 65.121
## - disp  1    10.110 158.64 65.229
## - am    1    12.323 160.85 65.672
## - hp    1    14.826 163.35 66.166
## + carb  1     0.685 147.84 66.973
## + vs    1     0.434 148.09 67.028
## + cyl   1     0.414 148.11 67.032
## - qsec  1    26.408 174.94 68.358
## - wt    1    69.127 217.66 75.350
## 
## Step:  AIC=63.46
## mpg ~ disp + hp + drat + wt + qsec + am
## 
##        Df Sum of Sq    RSS    AIC
## - drat  1     3.345 153.44 62.162
## - disp  1     8.545 158.64 63.229
## &lt;none&gt;              150.09 63.457
## - hp    1    13.285 163.38 64.171
## + gear  1     1.565 148.53 65.121
## + cyl   1     1.003 149.09 65.242
## + vs    1     0.645 149.45 65.319
## + carb  1     0.107 149.99 65.434
## - am    1    20.036 170.13 65.466
## - qsec  1    25.574 175.67 66.491
## - wt    1    67.572 217.66 73.351
## 
## Step:  AIC=62.16
## mpg ~ disp + hp + wt + qsec + am
## 
##        Df Sum of Sq    RSS    AIC
## - disp  1     6.629 160.07 61.515
## &lt;none&gt;              153.44 62.162
## - hp    1    12.572 166.01 62.682
## + drat  1     3.345 150.09 63.457
## + gear  1     2.977 150.46 63.535
## + cyl   1     2.447 150.99 63.648
## + vs    1     1.121 152.32 63.927
## + carb  1     0.011 153.43 64.160
## - qsec  1    26.470 179.91 65.255
## - am    1    32.198 185.63 66.258
## - wt    1    69.043 222.48 72.051
## 
## Step:  AIC=61.52
## mpg ~ hp + wt + qsec + am
## 
##        Df Sum of Sq    RSS    AIC
## - hp    1     9.219 169.29 61.307
## &lt;none&gt;              160.07 61.515
## + disp  1     6.629 153.44 62.162
## + carb  1     3.227 156.84 62.864
## + drat  1     1.428 158.64 63.229
## - qsec  1    20.225 180.29 63.323
## + cyl   1     0.249 159.82 63.465
## + vs    1     0.249 159.82 63.466
## + gear  1     0.171 159.90 63.481
## - am    1    25.993 186.06 64.331
## - wt    1    78.494 238.56 72.284
## 
## Step:  AIC=61.31
## mpg ~ wt + qsec + am
## 
##        Df Sum of Sq    RSS    AIC
## &lt;none&gt;              169.29 61.307
## + hp    1     9.219 160.07 61.515
## + carb  1     8.036 161.25 61.751
## + disp  1     3.276 166.01 62.682
## + cyl   1     1.501 167.78 63.022
## + drat  1     1.400 167.89 63.042
## + gear  1     0.123 169.16 63.284
## + vs    1     0.000 169.29 63.307
## - am    1    26.178 195.46 63.908
## - qsec  1   109.034 278.32 75.217
## - wt    1   183.347 352.63 82.790</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## 
## Call:
## lm(formula = mpg ~ wt + qsec + am, data = mtcars)
## 
## Coefficients:
## (Intercept)           wt         qsec           am  
##       9.618       -3.917        1.226        2.936</code></pre></div>

<hr />
<p>## Regressão Linear Generalizada</p>

<p>A regressão linear normal pode ser inadequada quando a distribuição de $Y_i$ é assimétrica, representa
dados de contagens ou então dados binários. Para lidar com esse problema, McCulagh e Nelder estenderam
a família de distribuições para ajuste da regressão para distribuições da <em>família exponencial</em>. Tal
família inclui as distribuições <code>normal</code>, <code>poisson</code>, <code>gama</code>, <code>normal inversa</code> e <code>binomial</code> (incluindo
<code>bernoulli</code>), entre outras. Também existe uma forma de adaptar os MLG para a distribuição <code>binomial negativa</code>.</p>

<p>A definição dos MLG é dada por</p>

<script type="math/tex; mode=display">Y_i \sim F(\mu_i, \phi)</script>

<script type="math/tex; mode=display">\mu_i = g^{-1}(\alpha + \beta_1 x_{i1} + \beta_p x_{ip})</script>

<p>O parâmetro $\phi$ é o parâmetro de precisão (inverso do parâmetro de dispersão) e $g$ é a <em>função de ligação</em>, que geralmente tem o papel de jogar o intervalo de vação de $\mu_i$ (espaço paramétrico) no intervalo $(-\inf, \inf)$.</p>

<p>Para ajustar um modelo linear generalizado, basta utilizar a função <code>glm</code> e informar, além da fórmula, a família de distribuições da resposta.</p>

<h3 id="famlias-de-distribuies">Famílias de distribuições</h3>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in function_list[[k]](value): não foi possível encontrar a função &quot;pander&quot;</code></pre></div>

<h3 id="ajuste-do-modelo">Ajuste do modelo</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste_glm <span class="o">&lt;-</span> glm<span class="p">(</span>resposta <span class="o">~</span> explicativas<span class="p">,</span> data <span class="o">=</span> dados<span class="p">,</span> family <span class="o">=</span> distribuicao<span class="p">)</span></code></pre></div>

<p>Para ver a lista de distribuições que podem ser passadas ao parâmetro <code>family</code>, rode <code>?family</code> no R.</p>

<p>Outro componente importante em modelos lineares generalizados é a função de ligação. De modo mais geral, o código para ajsutar um MLG fica assim:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste_glm <span class="o">&lt;-</span> glm<span class="p">(</span>resposta <span class="o">~</span> explicativas<span class="p">,</span> data <span class="o">=</span> dados<span class="p">,</span> family <span class="o">=</span> distribuicao<span class="p">(</span>link <span class="o">=</span> funcao_de_ligacao<span class="p">))</span></code></pre></div>

<p>Repare que agora existe a parte <code>(link = funcao_de_ligacao)</code> depois do nome da distribuição escolhida. É comum trocar a ligação <code>inversa</code> de uma regressão Gama para uma ligação <code>log</code>, por exemplo. Em R, ficaria:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste_gama <span class="o">&lt;-</span> glm<span class="p">(</span>Y <span class="o">~</span> X <span class="o">+</span> <span class="kp">I</span><span class="p">(</span>X<span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> Z<span class="p">,</span> data <span class="o">=</span> dados<span class="p">,</span> family <span class="o">=</span> Gamma<span class="p">(</span>link <span class="o">=</span> <span class="s">&quot;log&quot;</span><span class="p">))</span></code></pre></div>

<p>Todas as funções úteis para <code>lm()</code> continuam sendo úteis para <code>glm()</code>.</p>

<h3 id="exemplo-regresso-logstica">Exemplo: Regressão logística</h3>

<p>A regressão logística se caracteriza por assumir distribuição binomial à variável resposta. Para exemplificar um ajuste de regressão logística, vamos aproveitar o mesmo banco <code>mtcars</code>, mas agora vamos modelar <code>am</code> em vez de <code>mpg</code>.</p>

<h4 id="breve-descritiva">Breve descritiva</h4>

<div class="highlight"><pre><code class="language-r" data-lang="r">mtcars <span class="o">%&gt;%</span>
  group_by<span class="p">(</span>am<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span><span class="s">&quot;N&quot;</span> <span class="o">=</span> n<span class="p">(),</span>
            <span class="s">&quot;Missing&quot;</span> <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span>wt<span class="p">)),</span>
            <span class="s">&quot;Media&quot;</span> <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>wt<span class="p">),</span>
            <span class="s">&quot;DesvPad&quot;</span> <span class="o">=</span> sd<span class="p">(</span>wt<span class="p">),</span>
            <span class="s">&quot;Minimo&quot;</span> <span class="o">=</span> <span class="kp">min</span><span class="p">(</span>wt<span class="p">),</span>
            <span class="s">&quot;Q1&quot;</span> <span class="o">=</span> quantile<span class="p">(</span>wt<span class="p">,</span> <span class="m">0.25</span><span class="p">),</span>
            <span class="s">&quot;Mediana&quot;</span> <span class="o">=</span> quantile<span class="p">(</span>wt<span class="p">,</span> <span class="m">0.50</span><span class="p">),</span>
            <span class="s">&quot;Q3&quot;</span> <span class="o">=</span> quantile<span class="p">(</span>wt<span class="p">,</span> <span class="m">0.75</span><span class="p">),</span>
            <span class="s">&quot;Maximo&quot;</span> <span class="o">=</span> <span class="kp">max</span><span class="p">(</span>wt<span class="p">))</span> <span class="o">%&gt;%</span>
  mutate_each<span class="p">(</span>funs<span class="p">(</span><span class="kp">round</span><span class="p">(</span><span class="m">.</span><span class="p">,</span><span class="m">1</span><span class="p">)),</span> <span class="o">-</span>am<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [2 x 10]
## 
##      am     N Missing Media DesvPad Minimo    Q1 Mediana    Q3 Maximo
##   (dbl) (dbl)   (dbl) (dbl)   (dbl)  (dbl) (dbl)   (dbl) (dbl)  (dbl)
## 1     0    19       0   3.8     0.8    2.5   3.4     3.5   3.8    5.4
## 2     1    13       0   2.4     0.6    1.5   1.9     2.3   2.8    3.6</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">ggplot<span class="p">(</span>mtcars<span class="p">)</span> <span class="o">+</span>
  geom_boxplot<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> <span class="kp">factor</span><span class="p">(</span>am<span class="p">),</span> y <span class="o">=</span> wt<span class="p">))</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-25-1.png" alt="plot of chunk unnamed-chunk-25" /></p>

<h4 id="ajuste">Ajuste</h4>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Ligação logit</span>
ajuste_glm <span class="o">&lt;-</span> glm<span class="p">(</span>am <span class="o">~</span> wt<span class="p">,</span> data <span class="o">=</span> mtcars<span class="p">,</span> family <span class="o">=</span> binomial<span class="p">)</span>
<span class="kp">summary</span><span class="p">(</span>ajuste_glm<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## 
## Call:
## glm(formula = am ~ wt, family = binomial, data = mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.11400  -0.53738  -0.08811   0.26055   2.19931  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)   12.040      4.510   2.670  0.00759 **
## wt            -4.024      1.436  -2.801  0.00509 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.230  on 31  degrees of freedom
## Residual deviance: 19.176  on 30  degrees of freedom
## AIC: 23.176
## 
## Number of Fisher Scoring iterations: 6</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">table</span><span class="p">(</span>mtcars<span class="o">$</span>am<span class="p">,</span> predict<span class="p">(</span>ajuste_glm<span class="p">)</span> <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    
##     FALSE TRUE
##   0    18    1
##   1     3   10</code></pre></div>

<p>Por padrão, a função de ligação da distribuição <code>binomial</code> é a <code>logit</code>. Se quisermos usar a função <code>probit</code>, precisamos especificar isto no parâmetro <code>family</code>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Ligaçao probit</span>
ajuste_glm_probit <span class="o">&lt;-</span> glm<span class="p">(</span>am <span class="o">~</span> wt<span class="p">,</span> data <span class="o">=</span> mtcars<span class="p">,</span> family <span class="o">=</span> binomial<span class="p">(</span>link <span class="o">=</span> <span class="s">&quot;probit&quot;</span><span class="p">))</span>
<span class="kp">summary</span><span class="p">(</span>ajuste_glm_probit<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## 
## Call:
## glm(formula = am ~ wt, family = binomial(link = &quot;probit&quot;), data = mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.04796  -0.55217  -0.05909   0.25290   2.18880  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)   6.7264     2.2684   2.965  0.00302 **
## wt           -2.2578     0.7197  -3.137  0.00171 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.230  on 31  degrees of freedom
## Residual deviance: 19.199  on 30  degrees of freedom
## AIC: 23.199
## 
## Number of Fisher Scoring iterations: 7</code></pre></div>

<p>Gráfico das curvas ajustadas:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ggplot<span class="p">(</span>mtcars<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>wt<span class="p">,</span> y<span class="o">=</span>am<span class="p">))</span> <span class="o">+</span> 
  geom_point<span class="p">()</span> <span class="o">+</span> 
  stat_smooth<span class="p">(</span>aes<span class="p">(</span>colour <span class="o">=</span> <span class="s">&quot;Logit&quot;</span><span class="p">),</span> method<span class="o">=</span><span class="s">&quot;glm&quot;</span><span class="p">,</span> family<span class="o">=</span>binomial<span class="p">,</span> se<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  stat_smooth<span class="p">(</span>aes<span class="p">(</span>colour <span class="o">=</span> <span class="s">&quot;Probit&quot;</span><span class="p">),</span> method<span class="o">=</span><span class="s">&quot;glm&quot;</span><span class="p">,</span> family<span class="o">=</span>binomial<span class="p">(</span>link <span class="o">=</span> <span class="s">&quot;probit&quot;</span><span class="p">),</span> se<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  stat_smooth<span class="p">(</span>aes<span class="p">(</span>colour <span class="o">=</span> <span class="s">&quot;Complementar Log-Log&quot;</span><span class="p">),</span> method<span class="o">=</span><span class="s">&quot;glm&quot;</span><span class="p">,</span> family<span class="o">=</span>binomial<span class="p">(</span>link <span class="o">=</span> <span class="s">&quot;cloglog&quot;</span><span class="p">),</span> se<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  labs<span class="p">(</span>colour <span class="o">=</span> <span class="s">&quot;Função de ligação&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-28-1.png" alt="plot of chunk unnamed-chunk-28" /></p>

<p>O teste Chi quadrado pode ser mais indicado para regressão logística.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">anova<span class="p">(</span>ajuste_glm<span class="p">,</span> test<span class="o">=</span><span class="s">&quot;Chisq&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Analysis of Deviance Table
## 
## Model: binomial, link: logit
## 
## Response: am
## 
## Terms added sequentially (first to last)
## 
## 
##      Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    
## NULL                    31     43.230              
## wt    1   24.054        30     19.176 9.369e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre></div>

<h3 id="anlise-de-diagnstico">Análise de diagnóstico</h3>

<p>Na página <a href="http://www.ime.usp.br/~giapaula/textoregressao.htm">do professor Gilberto</a> pode-se obter o livro dele sobre GLM e também vários comandos para realizar análises de diagnóstico dos modelos ajustados.</p>

<h2 id="modelos-mistos">Modelos mistos</h2>

<p>Quando uma mesma unidade observacional é medida várias vezes em diferentes contextos, temos em mãos um problema de medidas repetidas. Em particular, quando essas medidas são realizadas ao longo do tempo, temos um problema de dados longitudinais.</p>

<p>A dificuldade desses tipos de estudo está no fato de que, como o mesmo indivíduo é observado em vários momentos, nem sempre é razoável considerar essas medidas como independentes. Por exemplo, se estou acompanhando o crescimento da massa de ovelhas ao longo do tempo, esperamos que a ovelha mais “gordinha” tende a ser sempre a mais gordinha.</p>

<p>Para resolver isso, geralmente impomos uma <em>estrutura de correlação</em> para observações de um mesmo indivíduo, e uma maneira de impor essa estrutura de correlação é realizar uma análise com efeitos mistos.</p>

<p>A grande diferença de um modelo de regressão comum e um modelo misto é que parte dos parâmetros são na verdade variáveis aleatórias. Não vamos entrar em detalhe na parte teórica, mas se quiser, dê uma lida no <a href="http://www.ime.usp.br/~jmsinger/Textos/Singer&amp;Nobre&amp;Rocha2012mar.pdf">livro do professor Singer</a>, que está em andamento.</p>

<p>Para ajustar modelos mistos geralmente utilizamos os pacotes <code>nlme</code> e <code>lme4</code>. O pacote <code>nlme</code> faz algumas coisas a mais na parte de modelos não lineares, mas o pacote <code>lme4</code> é muito melhor desenvolvido atualmente e recomendamos seu uso.</p>

<h3 id="exemplo-teste-t-pareado">Exemplo: Teste t pareado</h3>

<p>Geralmente utilizamos o teste t pareado quando queremos comparar médias, mas os indivíduos foram medidos em diferentes situações ou momentos.</p>

<p>Vamos ilustrar com os seguintes dados. Na base de dados <code>sleep</code>, temos medido o efeito de duas diferentes drogas aplicadas a 10 indivíduos (as duas drogas foram aplicadas nos 10 indivíduos) no tempo de sono. Queremos verificar se as drogas tiveram efeitos distintos.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">sleep <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>group<span class="o">=</span><span class="kp">paste0</span><span class="p">(</span><span class="s">&#39;droga_&#39;</span><span class="p">,</span> group<span class="p">))</span> <span class="o">%&gt;%</span>
  spread<span class="p">(</span>group<span class="p">,</span> extra<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##    ID droga_1 droga_2
## 1   1     0.7     1.9
## 2   2    -1.6     0.8
## 3   3    -0.2     1.1
## 4   4    -1.2     0.1
## 5   5    -0.1    -0.1
## 6   6     3.4     4.4
## 7   7     3.7     5.5
## 8   8     0.8     1.6
## 9   9     0.0     4.6
## 10 10     2.0     3.4</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">sleep <span class="o">%&gt;%</span>
  ggplot<span class="p">()</span> <span class="o">+</span>
  geom_line<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>group<span class="p">,</span> y<span class="o">=</span>extra<span class="p">,</span> group<span class="o">=</span>ID<span class="p">))</span> <span class="o">+</span>
  geom_text<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>group<span class="p">,</span> y<span class="o">=</span>extra<span class="p">,</span> label<span class="o">=</span>ID<span class="p">))</span> <span class="o">+</span>
  theme_bw<span class="p">()</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-30-1.png" alt="plot of chunk unnamed-chunk-30" /></p>

<p>Teste t pareado</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">aux <span class="o">&lt;-</span> sleep <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>group<span class="o">=</span><span class="kp">paste0</span><span class="p">(</span><span class="s">&#39;droga_&#39;</span><span class="p">,</span> group<span class="p">))</span> <span class="o">%&gt;%</span>
  spread<span class="p">(</span>group<span class="p">,</span> extra<span class="p">)</span>

t.test<span class="p">(</span>aux<span class="o">$</span>droga_1<span class="p">,</span> aux<span class="o">$</span>droga_2<span class="p">,</span> paired<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## 
## 	Paired t-test
## 
## data:  aux$droga_1 and aux$droga_2
## t = -4.0621, df = 9, p-value = 0.002833
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -2.4598858 -0.7001142
## sample estimates:
## mean of the differences 
##                   -1.58</code></pre></div>

<p>Paralelo do modelo misto</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>lme4<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in library(lme4): there is no package called &#39;lme4&#39;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">modelo <span class="o">&lt;-</span> lmer<span class="p">(</span>extra <span class="o">~</span> group <span class="o">+</span> <span class="m">1</span><span class="o">|</span>ID<span class="p">,</span> data<span class="o">=</span>sleep<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): não foi possível encontrar a função &quot;lmer&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">summary</span><span class="p">(</span>modelo<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in summary(modelo): objeto &#39;modelo&#39; não encontrado</code></pre></div>

<p>A parte <code>1|ID</code> indica que o indivíduo é ID e que estamos incluindo um efeito aleatório para ele.</p>

<h1 id="rvore-de-deciso">Árvore de Decisão</h1>

<p>Outra tipo de modelo muito utilizado que também une simplicidade com eficiência é o de árvore de decisão. No R, seu ajuste é tão simples quanto ajustar um modelo de regressão e possui um conjunto de funções igualmente convenientes para extrair resultados.</p>

<p>Vamos apresentar como ajustar árvore de decisão usando o pacote <code>tree</code>, mas, como tudo no R, existem inúmeros pacotes e jeitos de ajustar uma árvore de decisão (ver este <a href="http://statistical-research.com/a-brief-tour-of-the-trees-and-forests/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=a-brief-tour-of-the-trees-and-forests">link</a> para uma lista interessante de alternativas).</p>

<h2 id="ajuste-1">Ajuste</h2>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>tree<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in library(tree): there is no package called &#39;tree&#39;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste_tree <span class="o">&lt;-</span> tree<span class="p">(</span><span class="kp">factor</span><span class="p">(</span>am<span class="p">)</span> <span class="o">~</span> wt<span class="p">,</span> data <span class="o">=</span> mtcars<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): não foi possível encontrar a função &quot;tree&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">summary</span><span class="p">(</span>ajuste_tree<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in summary(ajuste_tree): objeto &#39;ajuste_tree&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">plot<span class="p">(</span>ajuste_tree<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in plot(ajuste_tree): objeto &#39;ajuste_tree&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">text<span class="p">(</span>ajuste_tree<span class="p">,</span> pretty <span class="o">=</span> <span class="m">0</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in text(ajuste_tree, pretty = 0): objeto &#39;ajuste_tree&#39; não encontrado</code></pre></div>

<p>Tabelas de observado versus predito: comparação entre os modelos logístico e árvore.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Logistico</span>
<span class="kp">table</span><span class="p">(</span>mtcars<span class="o">$</span>am<span class="p">,</span> predict<span class="p">(</span>ajuste_glm<span class="p">)</span> <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)</span>

<span class="c1"># Árvore</span>
<span class="kp">table</span><span class="p">(</span>mtcars<span class="o">$</span>am<span class="p">,</span> predict<span class="p">(</span>ajuste_tree<span class="p">)[,</span><span class="s">&quot;1&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)</span></code></pre></div>

<h2 id="cross-validation">Cross-validation</h2>

<p>Árvores tendem a “super-ajustar” (<em>overfit</em>) o modelo. Para este problema, <em>cross-validation</em> é uma boa prática. Essa técnica consiste em reservar parte da base separada para depois ser usada como régua para o poder preditivo do modelo.</p>

<p>Para fazer isso é muito fácil com a função <code>cv.tree()</code>. Basta passar seu modelo ajustado para ela:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
cv_tree <span class="o">&lt;-</span> cv.tree<span class="p">(</span>ajuste_tree<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): não foi possível encontrar a função &quot;cv.tree&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">plot<span class="p">(</span>cv_tree<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in plot(cv_tree): objeto &#39;cv_tree&#39; não encontrado</code></pre></div>

<p>O gráfico mostra qual tamanho da árvore que apresentou o menor erro de predição. No nosso caso foi tamanho <code>2</code>.</p>

<p>Para recuperar esse ajuste de tamanho <code>2</code>, chamamos a função <code>prune.tree()</code> da seguinte forma:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># seleciona a árvoore com 2 nós</span>
melhor_tree <span class="o">&lt;-</span> prune.tree<span class="p">(</span>ajuste_tree<span class="p">,</span> best <span class="o">=</span> <span class="m">2</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): não foi possível encontrar a função &quot;prune.tree&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Gráfico que representa a árvore `melhor_tree`</span>
plot<span class="p">(</span>melhor_tree<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in plot(melhor_tree): objeto &#39;melhor_tree&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">text<span class="p">(</span>melhor_tree<span class="p">,</span> pretty <span class="o">=</span> <span class="m">0</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in text(melhor_tree, pretty = 0): objeto &#39;melhor_tree&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># oservado versus predito</span>
<span class="kp">table</span><span class="p">(</span>mtcars<span class="o">$</span>am<span class="p">,</span> predict<span class="p">(</span>melhor_tree<span class="p">)[,</span><span class="s">&quot;1&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in predict(melhor_tree): objeto &#39;melhor_tree&#39; não encontrado</code></pre></div>

<p>O modelo <code>melhor_tree</code> coincidiu com o <code>ajuste_tree</code> (que tinha tamanho <code>5</code>) quanto ao seu desempenho em prever, porém é muito mais simples. De fato ele é mais simples do que qualquer modelo feito até aqui.</p>

<h2 id="parmetros-de-controle">Parâmetros de controle</h2>

<p>Árvores de decisão são ajustadas sob alguns critérios que às vezes precisamos reconfigurar. Por exemplo, no <code>ajuste_tree</code> vimos que havia muito mais galhos do que o necessário. Isso se deveu a critérios de divisão/parada desregulado.</p>

<p>No caso dos objetos <code>tree</code>, temos dois parâmetros importantes: <code>split</code> e <code>control</code>.</p>

<p><strong>split</strong></p>

<p>O parâmetro <code>split</code> define qual o critério para decidir se divide o “galho” ou não. Por padrão, a função utiliza o critério “deviance”, que tem a mesma definição do MLG. Uma segunda opção seria <strong>Gini</strong>.</p>

<p><strong>control</strong></p>

<p>O parâmetro <code>control</code> recebe um objeto retornado pela função <code>tree.control()</code>.</p>

<p>Esta função permite você configurar:</p>

<ul>
  <li><code>nobs</code> Número de observações na base de treino. Isso será efetivo no <code>cv.tree()</code>, quando uma base de treino e outra de teste é utilizada para calcular o erro de predição por meio de <em>cross-validation</em>.</li>
  <li><code>mincut</code> Número mínimo de observações a serem incluídas em cada nó.</li>
  <li><code>minsize</code> O menor tamanho de nó permitido.</li>
  <li><code>mindev</code> Fração mínima do deviance do nó raiz.</li>
</ul>

<p>Como passar à função:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">controles <span class="o">&lt;-</span> tree.control<span class="p">(</span>nobs <span class="o">=</span> <span class="m">32</span><span class="p">,</span> mincut <span class="o">=</span> <span class="m">10</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): não foi possível encontrar a função &quot;tree.control&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">ajuste_tree <span class="o">&lt;-</span> ajuste_tree <span class="o">&lt;-</span> tree<span class="p">(</span><span class="kp">factor</span><span class="p">(</span>am<span class="p">)</span> <span class="o">~</span> wt<span class="p">,</span> data <span class="o">=</span> mtcars<span class="p">,</span> control <span class="o">=</span> controles<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): não foi possível encontrar a função &quot;tree&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">plot<span class="p">(</span>ajuste_tree<span class="p">);</span>text<span class="p">(</span>ajuste_tree<span class="p">,</span> pretty <span class="o">=</span> <span class="m">0</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in plot(ajuste_tree): objeto &#39;ajuste_tree&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in text(ajuste_tree, pretty = 0): objeto &#39;ajuste_tree&#39; não encontrado</code></pre></div>

<h1 id="anlise-multivariada">Análise multivariada</h1>

<h2 id="anlise-de-agrupamento">Análise de Agrupamento</h2>

<p>Análise de agrupamento geralmente é uma ótima maneira de realizar estudos preliminares em uma base de dados, e algumas vezes pode trazer resultados muito úteis.</p>

<p>Como o próprio nome diz, geralmente a análise de agrupamento serve para formar grupos de indivíduos a partir da comparação das suas medidas em relação à diversas variáveis. Não confunda aqui com árvores de decisão, pois nesse caso não há uma variável “resposta”.</p>

<p>Existem dois tipos principais de análise de agrupamento: <em>hierárquico</em> e <em>k-means</em>.</p>

<h3 id="k-means">K-means</h3>
<p>No modelo k-means, selecionamos previamente o número de grupos e o modelo calcula, com base em algum critério, qual a melhor forma de alocar os indivíduos nesses grupos.</p>

<p>Para ajustar essa análise utilizaremos a função <code>kmeans</code> do pacote <code>stats</code>. Existem mais pacotes que fazem essa análise no R.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">kms <span class="o">&lt;-</span> kmeans<span class="p">(</span>mtcars<span class="p">,</span> centers<span class="o">=</span><span class="m">2</span><span class="p">)</span>
kms</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## K-means clustering with 2 clusters of sizes 18, 14
## 
## Cluster means:
##        mpg      cyl     disp        hp     drat       wt     qsec
## 1 23.97222 4.777778 135.5389  98.05556 3.882222 2.609056 18.68611
## 2 15.10000 8.000000 353.1000 209.21429 3.229286 3.999214 16.77214
##          vs        am     gear     carb
## 1 0.7777778 0.6111111 4.000000 2.277778
## 2 0.0000000 0.1428571 3.285714 3.500000
## 
## Clustering vector:
##           Mazda RX4       Mazda RX4 Wag          Datsun 710 
##                   1                   1                   1 
##      Hornet 4 Drive   Hornet Sportabout             Valiant 
##                   1                   2                   1 
##          Duster 360           Merc 240D            Merc 230 
##                   2                   1                   1 
##            Merc 280           Merc 280C          Merc 450SE 
##                   1                   1                   2 
##          Merc 450SL         Merc 450SLC  Cadillac Fleetwood 
##                   2                   2                   2 
## Lincoln Continental   Chrysler Imperial            Fiat 128 
##                   2                   2                   1 
##         Honda Civic      Toyota Corolla       Toyota Corona 
##                   1                   1                   1 
##    Dodge Challenger         AMC Javelin          Camaro Z28 
##                   2                   2                   2 
##    Pontiac Firebird           Fiat X1-9       Porsche 914-2 
##                   2                   1                   1 
##        Lotus Europa      Ford Pantera L        Ferrari Dino 
##                   1                   2                   1 
##       Maserati Bora          Volvo 142E 
##                   2                   1 
## 
## Within cluster sum of squares by cluster:
## [1] 58920.54 93643.90
##  (between_SS / total_SS =  75.5 %)
## 
## Available components:
## 
## [1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;    
## [5] &quot;tot.withinss&quot; &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;        
## [9] &quot;ifault&quot;</code></pre></div>

<h3 id="hierrquico">Hierárquico</h3>

<p>No modelo hierárquico, contudo, não selecionamos previamente o número de grupos, e o resultado da análise é um gráfico chamado <em>dendrograma</em>, que cria uma ordem de agrupamento dos indivíduos, desde o nível mais fragmentado (número de grupos igual ao número de indivíduos) até um agrupamento único.</p>

<p>Para ajustar o modelo hierárquico, utilizaremos a função <code>hclust</code>, do pacote <code>stats</code>. Existem vários métodos para ordenação dos ordenamentos. Utilizaremos aqui o método <code>ward.D</code>.</p>

<p>Diferentemente do método K-means, os métodos hierárquicos partem de uma matriz de distâncias ou, mais genericamente, matriz de dissimilaridades. A matrix de distâncias é uma matriz <code>d</code> com <code>dim(d) = c(n, n)</code>, onde <code>n</code> é o número de indivíduos. Geralmente é uma matriz simétrica, e na diagonal vale zero.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">d <span class="o">&lt;-</span> dist<span class="p">(</span>mtcars<span class="p">)</span> <span class="c1"># calcula matriz de distâncias euclidianas.</span>
str<span class="p">(</span>d<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Class &#39;dist&#39;  atomic [1:496] 0.615 54.909 98.113 210.337 65.472 ...
##   ..- attr(*, &quot;Size&quot;)= int 32
##   ..- attr(*, &quot;Labels&quot;)= chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##   ..- attr(*, &quot;Diag&quot;)= logi FALSE
##   ..- attr(*, &quot;Upper&quot;)= logi FALSE
##   ..- attr(*, &quot;method&quot;)= chr &quot;euclidean&quot;
##   ..- attr(*, &quot;call&quot;)= language dist(x = mtcars)</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">hc <span class="o">&lt;-</span> hclust<span class="p">(</span>d<span class="p">,</span> method<span class="o">=</span><span class="s">&#39;ward.D&#39;</span><span class="p">)</span>
hc</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## 
## Call:
## hclust(d = d, method = &quot;ward.D&quot;)
## 
## Cluster method   : ward.D 
## Distance         : euclidean 
## Number of objects: 32</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">plot<span class="p">(</span>hc<span class="p">)</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-39-1.png" alt="plot of chunk unnamed-chunk-39" /></p>

<p>No método hierárquico, portanto, geralmente precisamos tomar 2 decisões para rodar a análise e construir o dendrograma: i) o método para obtenção da matriz de distâncias e o método para ordenação das aglomerações.</p>

<p><strong>OBS:</strong> Na análise de agrupamento, muitas vezes a escala das variáveis faz diferença, e variáveis que assumem valores muito altos podem ter uma influência maior do que outras no resultado da análise. Por isso, muitas vezes temos interesse em re-escalar as variáveis, geralmente subtraindo a média e dividindo pelo desvio padrão (normalização). Para isso, veja <code>?scale</code>.</p>

<h2 id="anlise-fatorial">Análise Fatorial</h2>

<p>Outra análise multivariada muito comum é a <em>análise fatorial</em>. Nesse tipo de estudo, geralmente estamos interessados em obter combinações de variáveis que estejam associadas a alguma variável latente não observável. Em palavras mais simples, estamos interessados em obter alguns <em>fatores</em> que expliquem a variabilidade dos nossos dados, e depois interpretar esses fatores de alguma forma.</p>

<p>Para realizar análise fatorial, vamos utilizar a função <code>factanal</code> do pacote <code>stats</code>. Essa função realiza análise fatorial usando método de máxima verossimilhança. Podemos utilizar outros métodos, como decomposição espectral (autovalor e autovetor), geralmente utilizada em <em>análise de componentes principais</em>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">fa <span class="o">&lt;-</span> factanal<span class="p">(</span>mtcars<span class="p">,</span> factors<span class="o">=</span><span class="m">3</span><span class="p">,</span> rotation<span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
fa</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## 
## Call:
## factanal(x = mtcars, factors = 3, rotation = &quot;none&quot;)
## 
## Uniquenesses:
##   mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb 
## 0.135 0.055 0.090 0.127 0.290 0.060 0.051 0.223 0.208 0.125 0.158 
## 
## Loadings:
##      Factor1 Factor2 Factor3
## mpg  -0.910   0.137  -0.136 
## cyl   0.962          -0.135 
## disp  0.937  -0.174         
## hp    0.875   0.292   0.147 
## drat -0.689   0.453   0.175 
## wt    0.858  -0.382   0.242 
## qsec -0.591  -0.754   0.177 
## vs   -0.809  -0.309   0.164 
## am   -0.522   0.719         
## gear -0.459   0.729   0.365 
## carb  0.594   0.517   0.471 
## 
##                Factor1 Factor2 Factor3
## SS loadings      6.448   2.465   0.565
## Proportion Var   0.586   0.224   0.051
## Cumulative Var   0.586   0.810   0.862
## 
## Test of the hypothesis that 3 factors are sufficient.
## The chi square statistic is 30.53 on 25 degrees of freedom.
## The p-value is 0.205</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">pesos <span class="o">&lt;-</span> fa<span class="o">$</span>loadings<span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span> <span class="o">%&gt;%</span> <span class="kt">data.frame</span> <span class="o">%&gt;%</span> mutate<span class="p">(</span>nomes<span class="o">=</span><span class="kp">rownames</span><span class="p">(</span><span class="m">.</span><span class="p">))</span>
ggplot<span class="p">(</span>pesos<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>Factor1<span class="p">,</span> y<span class="o">=</span>Factor2<span class="p">))</span> <span class="o">+</span>
  geom_text<span class="p">(</span>aes<span class="p">(</span>label<span class="o">=</span>nomes<span class="p">))</span> <span class="o">+</span>
  geom_vline<span class="p">(</span>xintercept<span class="o">=</span><span class="m">0</span><span class="p">)</span> <span class="o">+</span>
  geom_hline<span class="p">(</span>yintercept<span class="o">=</span><span class="m">0</span><span class="p">)</span> <span class="o">+</span>
  coord_equal<span class="p">()</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-40-1.png" alt="plot of chunk unnamed-chunk-40" /></p>

<p>Na análise fatorial, podemos realizar também a <em>rotação</em> dos fatores obtidos, para tentar isolar os componentes de cada fator, facilitando a interpretação dos fatores. O método mais comum para realizar a rotação é pelo método <code>varimax</code>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">fa <span class="o">&lt;-</span> factanal<span class="p">(</span>mtcars<span class="p">,</span> factors<span class="o">=</span><span class="m">3</span><span class="p">,</span> rotation<span class="o">=</span><span class="s">&#39;varimax&#39;</span><span class="p">)</span>

pesos <span class="o">&lt;-</span> fa<span class="o">$</span>loadings<span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span> <span class="o">%&gt;%</span> <span class="kt">data.frame</span> <span class="o">%&gt;%</span> mutate<span class="p">(</span>nomes<span class="o">=</span><span class="kp">rownames</span><span class="p">(</span><span class="m">.</span><span class="p">))</span>
ggplot<span class="p">(</span>pesos<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>Factor1<span class="p">,</span> y<span class="o">=</span>Factor2<span class="p">))</span> <span class="o">+</span>
  geom_text<span class="p">(</span>aes<span class="p">(</span>label<span class="o">=</span>nomes<span class="p">))</span> <span class="o">+</span>
  geom_vline<span class="p">(</span>xintercept<span class="o">=</span><span class="m">0</span><span class="p">)</span> <span class="o">+</span>
  geom_hline<span class="p">(</span>yintercept<span class="o">=</span><span class="m">0</span><span class="p">)</span> <span class="o">+</span>
  coord_equal<span class="p">()</span></code></pre></div>

<p><img src="/images/2016-01-24-aula07/unnamed-chunk-41-1.png" alt="plot of chunk unnamed-chunk-41" /></p>

<p>A análise fatorial tem muito mais detalhes que foram omitidos. Para um tutorial rápido, ver no <a href="http://www.statmethods.net/advstats/factor.html">Quick-R</a>.</p>

<h2 id="anlise-de-correspondncia-mltipla">Análise de correspondência múltipla</h2>

<p>Quando temos uma base de dados com muitas variáveis categóticas, geralmente é difícil analisá-las em conjunto, e muitas vezes ficamos fazendo um monte de tabelas de contingência, o que pode ser doloroso.</p>

<p>A análise de correspondência múltipla pode ser considerada como uma espécie de <em>análise de componentes principais</em> para dados categóricos. Ela serve para dar uma “visão geral” da base de dados, reduzindo a dimensionalidade da base e visualizando as associações das variáveis em apenas um gráfico.</p>

<p>Para realizar a análise, vamos utilizar a função <code>MCA</code> do pacote <code>FactoMineR</code>. Esse pacote, aliás, contém diversos métodos para realização de análises multivariadas.</p>

<p>Como base de dados, utilizaremos <code>tea</code> do pacote <code>FactoMiner</code>, que é basicamente um questionário aplicado a 300 pessoas sobre como elas tomam chá.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>FactoMiner<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in library(FactoMiner): there is no package called &#39;FactoMiner&#39;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">data<span class="p">(</span>tea<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Warning in data(tea): data set &#39;tea&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Vamos trabalhas só com essas colunas</span>
newtea <span class="o">&lt;-</span> tea <span class="o">%&gt;%</span> select<span class="p">(</span>Tea<span class="p">,</span> How<span class="p">,</span> how<span class="p">,</span> sugar<span class="p">,</span> where<span class="p">,</span> always<span class="p">)</span> <span class="o">%&gt;%</span> tbl_df</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): objeto &#39;tea&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">newtea</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): objeto &#39;newtea&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># numero de niveis de cada variavel</span>
cats <span class="o">&lt;-</span> newtea <span class="o">%&gt;%</span> summarise_each<span class="p">(</span>funs<span class="p">(</span><span class="kp">length</span><span class="p">(</span><span class="kp">unique</span><span class="p">(</span><span class="m">.</span><span class="p">))))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): objeto &#39;newtea&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">cats</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): objeto &#39;cats&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># MCA</span>
mca <span class="o">&lt;-</span> MCA<span class="p">(</span>newtea<span class="p">,</span> graph <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in eval(expr, envir, enclos): não foi possível encontrar a função &quot;MCA&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Coordenadas das variaveis</span>
mca1_vars_df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>mca<span class="o">$</span>var<span class="o">$</span>coord<span class="p">,</span> variavel<span class="o">=</span><span class="kp">rep</span><span class="p">(</span><span class="kp">names</span><span class="p">(</span>cats<span class="p">),</span> cats<span class="p">),</span> stringsAsFactors<span class="o">=</span><span class="bp">F</span><span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>rnames<span class="o">=</span><span class="kp">row.names</span><span class="p">(</span><span class="m">.</span><span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in data.frame(mca$var$coord, variavel = rep(names(cats), cats), : objeto &#39;mca&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Coordenadas das observacoes</span>
mca1_obs_df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>mca<span class="o">$</span>ind<span class="o">$</span>coord<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in data.frame(mca$ind$coord): objeto &#39;mca&#39; não encontrado</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Um gráfico bonito</span>
ggplot<span class="p">()</span> <span class="o">+</span>
  geom_hline<span class="p">(</span>yintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_vline<span class="p">(</span>xintercept <span class="o">=</span> <span class="m">0</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;gray70&quot;</span><span class="p">)</span> <span class="o">+</span>
  geom_text<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>Dim.1<span class="p">,</span> y<span class="o">=</span>Dim.2<span class="p">,</span> colour<span class="o">=</span>variavel<span class="p">,</span> label<span class="o">=</span>rnames<span class="p">),</span> data<span class="o">=</span>mca1_vars_df<span class="p">)</span> <span class="o">+</span>
  geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>Dim.1<span class="p">,</span> y<span class="o">=</span>Dim.2<span class="p">),</span> colour <span class="o">=</span> <span class="s">&quot;gray50&quot;</span><span class="p">,</span> alpha <span class="o">=</span> <span class="m">0.7</span><span class="p">,</span> data<span class="o">=</span>mca1_obs_df<span class="p">)</span> <span class="o">+</span>
  geom_density2d<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>Dim.1<span class="p">,</span> y<span class="o">=</span>Dim.2<span class="p">),</span> colour <span class="o">=</span> <span class="s">&quot;gray80&quot;</span><span class="p">,</span> data<span class="o">=</span>mca1_obs_df<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error in do.call(&quot;layer&quot;, list(mapping = mapping, data = data, stat = stat, : objeto &#39;mca1_vars_df&#39; não encontrado</code></pre></div>

<p>O gráfico mostra várias coisas de uma vez só.</p>

<ul>
  <li>A dispersão mostra as dimensões calculadas pelo método de análise de correspondência múltipla.</li>
  <li>As curvas de nível mostram a concentração dos dados.</li>
  <li>Os textos são os níveis das variáveis, identificados pela cor.</li>
</ul>

<p>Nesse caso, verificamos, por exemplo, que pode existir uma associação entre <code>how</code> e <code>where</code>, pois “tea bag” está muito próximo de “chain store”.</p>

<p><strong>OBS:</strong> Baseado no excelente post de <a href="http://gastonsanchez.com/blog/how-to/2012/10/13/MCA-in-R.html">Gaston Sanchez</a>.</p>

<h1 id="demais-tpicos">Demais tópicos</h1>

<ul>
  <li>Séries temporais</li>
  <li>Dados categorizados</li>
  <li>GAM/GAMLSS</li>
  <li>Inferência Bayesiana</li>
  <li>Processos estocásticos</li>
  <li>Reamostragem</li>
  <li>Muito mais!</li>
</ul>

<h1 id="referncias">Referências</h1>

<p>http://www-bcf.usc.edu/~gareth/ISL/ISLR%20First%20Printing.pdf</p>

<p>http://web.stanford.edu/~hastie/local.ftp/Springer/OLD/ESLII_print4.pdf</p>

<p>http://www.ime.usp.br/~giapaula/texto_2013.pdf</p>

<p>Colosimo, E.A. e Giolo, S.R. (2006) Análise de sobrevivência aplicada. ABE - Projeto Fisher, Blucher.</p>

<p>http://adv-r.had.co.nz/Functions.html</p>

<p>http://www.burns-stat.com/pages/Tutor/R_inferno.pdf</p>

      </article>
      <hr>
        <div class="bdsharebuttonbox">
            <a href="#" class="bds_more" data-cmd="more"></a>
            <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
            <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
            <a href="#" class="bds_fbook" data-cmd="fbook" title="Share to Facebook"></a>
            <a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a>
        </div>
        <script>
            window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    </div>
	
    <!-- duoshuo.com javascript include code. -->    
    
    <!-- disqus.com javascript include code. -->
	
    <div class="post-area post comment">
        <div id="disqus_thread"></div>
    </div>
	<script>
		var disqus_config = function () {
			this.page.url = "http://curso-r.github.io/aula07/"; 
			this.page.identifier = "/aula07"; 
		};
		(function() {
			var d = document, s = d.createElement('script');
			s.src = '//curso-r.disqus.com/embed.js';
			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
		})();
	</script>
	
    
  </div>
  
  <div id="content" class="col-sm-3">
    <!-- <div id="myAffix" class="shadow-bottom-center hidden-xs" data-spy="affix" data-offset-top="0" data-offset-bottom="-20"> -->
    <div id="myAffix" class="shadow-bottom-center hidden-xs" >
      <div class="categories-list-header">
        Content
      </div>
      <div class="content-text"></div>
    </div>
  </div>
  
</div>
    </div>

    
    <div id="top" data-toggle="tooltip" data-placement="left" title="back to top">
      <a href="javascript:;">
        <div class="arrow"></div>
        <div class="stick"></div>
      </a>
    </div>

    <footer class="">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <a href="mailto:"><span class="glyphicon glyphicon-envelope"></span> </a>
        <span class="point"> · </span>
        
          <a href="https://github.com/curso-r">
            <span class="icon">
              <svg viewBox="0 0 16 16">
                <path fill="#aaa" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            Github
            <!-- <span>curso-r</span> -->
          </a>
          
          <span class="point"> · </span>
          <span><a href="https://github.com/curso-r/curso-r.github.io/blob/master/_posts/2016-01-24-aula07.md">View source</a></span>
          <span class="point"> · </span>
          <span><a class="newpost" href="javascript:;">New post</a></span>
		  <span class="point"> · </span>
          <span><a href="/feed.xml">RSS</a></span>
          <span class="point"> · </span>
          <span>&copy; 2015 LiXizhi</span>
      </div>
    </div>
  </div>
</footer>

    <script type="text/javascript">
    function OnClickNewPost()
    {
        var title = prompt("Please enter title of your post");
        if (title!=null){
            title = title.replace(" ", "-");
            var currentdate = new Date();
            var urlNewPage = "https://github.com/curso-r/curso-r.github.io/new/master?filename=_posts/" 
                + currentdate.getFullYear() + "-" + (currentdate.getMonth()+1) + "-" + currentdate.getDate() + "-" + title + ".md";
                
            var defaultText =  [
                '---',
                'layout: post',
                'comments: true',
                'categories: diary',
                '---',
                '## Title',
                'text'
                ].join('\n');
            urlNewPage += "&value=" + encodeURIComponent(defaultText);
            window.open(urlNewPage);
        }
    }
    
    $(function() {
      // CreateNewPostLinks
      $('.newpost').each(function(){
          $(this).click(OnClickNewPost);
      });
    });
</script>
  
  </body>
</html>
